

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Create Vhost-User &mdash; Vector Packet Processor 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="prev" title="Vhost User Commands" href="index.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Vector Packet Processor
          

          
            
            <img src="../../../_static/fd-io_red_white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gettingstarted/index.html">Getting Started (Users)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usecases/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gstarteddevel/index.html">Getting Started (Developers)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides/index.html">User Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Command Line Reference</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../interface/index.html">Interface Commands</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Vhost User Commands</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Create Vhost-User</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show-vhost-user">Show Vhost-User</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debug-vhost-user">Debug Vhost-User</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-vhost-user">Delete Vhost-User</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vector Packet Processor</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Reference</a> &raquo;</li>
        
          <li><a href="../index.html">Command Line Reference</a> &raquo;</li>
        
          <li><a href="index.html">Vhost User Commands</a> &raquo;</li>
        
      <li>Create Vhost-User</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/reference/cmdreference/vhost/vhostuser.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound" id="vhostusercommands">
</div>
<div class="section" id="create-vhost-user">
<span id="createvhostuser"></span><h1>Create Vhost-User<a class="headerlink" href="#create-vhost-user" title="Permalink to this headline">¶</a></h1>
<p>Create a vHost User interface. Once created, a new virtual interface
will exist with the name ‘<em>VirtualEthernet0/0/x</em>’, where ‘<em>x</em>’ is the
next free index.</p>
<p>There are several parameters associated with a vHost interface:</p>
<ul class="simple">
<li><strong>socket &lt;socket-filename&gt;</strong> - Name of the linux socket used by
hypervisor and VPP to manage the vHost interface. If in ‘<em>server</em>’
mode, VPP will create the socket if it does not already exist. If in
‘<em>client</em>’ mode, hypervisor will create the socket if it does not
already exist. The VPP code is indifferent to the file location.
However, if SELinux is enabled, then the socket needs to be created
in ‘<em>/var/run/vpp/</em>’.</li>
<li><strong>server</strong> - Optional flag to indicate that VPP should be the server
for the linux socket. If not provided, VPP will be the client. In
‘<em>server</em>’ mode, the VM can be reset without tearing down the vHost
Interface. In ‘<em>client</em>’ mode, VPP can be reset without bringing down
the VM and tearing down the vHost Interface.</li>
<li><strong>feature-mask &lt;hex&gt;</strong> - Optional virtio/vhost feature set negotiated
at startup. <strong>This is intended for degugging only.</strong> It is
recommended that this parameter not be used except by experienced
users. By default, all supported features will be advertised.
Otherwise, provide the set of features desired.<ul>
<li>0x000008000 (15) - VIRTIO_NET_F_MRG_RXBUF</li>
<li>0x000020000 (17) - VIRTIO_NET_F_CTRL_VQ</li>
<li>0x000200000 (21) - VIRTIO_NET_F_GUEST_ANNOUNCE</li>
<li>0x000400000 (22) - VIRTIO_NET_F_MQ</li>
<li>0x004000000 (26) - VHOST_F_LOG_ALL</li>
<li>0x008000000 (27) - VIRTIO_F_ANY_LAYOUT</li>
<li>0x010000000 (28) - VIRTIO_F_INDIRECT_DESC</li>
<li>0x040000000 (30) - VHOST_USER_F_PROTOCOL_FEATURES</li>
<li>0x100000000 (32) - VIRTIO_F_VERSION_1</li>
</ul>
</li>
<li><strong>hwaddr &lt;mac-addr&gt;</strong> - Optional ethernet address, can be in either
X:X:X:X:X:X unix or X.X.X cisco format.</li>
<li><strong>renumber &lt;dev_instance&gt;</strong> - Optional parameter which allows the
instance in the name to be specified. If instance already exists,
name will be used anyway and multiple instances will have the same
name. Use with caution.</li>
</ul>
<div class="section" id="summary-usage">
<h2>Summary/Usage<a class="headerlink" href="#summary-usage" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>create vhost-user socket &lt;socket-filename&gt; <span class="o">[</span>server<span class="o">]</span> <span class="o">[</span>feature-mask &lt;hex&gt;<span class="o">]</span> <span class="o">[</span>hwaddr &lt;mac-addr&gt;<span class="o">]</span> <span class="o">[</span>renumber &lt;dev_instance&gt;<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>Example of how to create a vhost interface with VPP as the client
and all features enabled:</div></blockquote>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# create vhost-user socket /var/run/vpp/vhost1.sock</span>
<span class="go">VirtualEthernet0/0/0</span>
</pre></div>
</div>
<p>Example of how to create a vhost interface with VPP as the server
and with just multiple queues enabled:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# create vhost-user socket /var/run/vpp/vhost2.sock server feature-mask 0x40400000</span>
<span class="go">VirtualEthernet0/0/1</span>
</pre></div>
</div>
<p>Once the vHost interface is created, enable the interface using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# set interface state VirtualEthernet0/0/0 up</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="show-vhost-user">
<span id="showvhost"></span><h1>Show Vhost-User<a class="headerlink" href="#show-vhost-user" title="Permalink to this headline">¶</a></h1>
<p>Display the attributes of a single vHost User interface (provide
interface name), multiple vHost User interfaces (provide a list of
interface names seperated by spaces) or all Vhost User interfaces (omit
an interface name to display all vHost interfaces).</p>
<div class="section" id="id1">
<h2>Summary/Usage<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>show vhost-user <span class="o">[</span>&lt;interface&gt; <span class="o">[</span>&lt;interface&gt; <span class="o">[</span>..<span class="o">]]]</span> <span class="o">[</span>descriptors<span class="o">]</span>.
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>Examples<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Example of how to display a vhost interface:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# show vhost-user VirtualEthernet0/0/0</span>
<span class="go">Virtio vhost-user interfaces</span>
<span class="go">Global:</span>
<span class="go">  coalesce frames 32 time 1e-3</span>
<span class="go">Interface: VirtualEthernet0/0/0 (ifindex 1)</span>
<span class="go">virtio_net_hdr_sz 12</span>
<span class="go"> features mask (0xffffffffffffffff):</span>
<span class="go"> features (0x50408000):</span>
<span class="go">   VIRTIO_NET_F_MRG_RXBUF (15)</span>
<span class="go">   VIRTIO_NET_F_MQ (22)</span>
<span class="go">   VIRTIO_F_INDIRECT_DESC (28)</span>
<span class="go">   VHOST_USER_F_PROTOCOL_FEATURES (30)</span>
<span class="go">  protocol features (0x3)</span>
<span class="go">   VHOST_USER_PROTOCOL_F_MQ (0)</span>
<span class="go">   VHOST_USER_PROTOCOL_F_LOG_SHMFD (1)</span>

<span class="go"> socket filename /var/run/vpp/vhost1.sock type client errno &quot;Success&quot;</span>

<span class="go">rx placement:</span>
<span class="go">   thread 1 on vring 1</span>
<span class="go">   thread 1 on vring 5</span>
<span class="go">   thread 2 on vring 3</span>
<span class="go">   thread 2 on vring 7</span>
<span class="go"> tx placement: spin-lock</span>
<span class="go">   thread 0 on vring 0</span>
<span class="go">   thread 1 on vring 2</span>
<span class="go">   thread 2 on vring 0</span>

<span class="go">Memory regions (total 2)</span>
<span class="go">region fd    guest_phys_addr    memory_size        userspace_addr     mmap_offset        mmap_addr</span>
<span class="go">====== ===== ================== ================== ================== ================== ==================</span>
<span class="go">  0     60    0x0000000000000000 0x00000000000a0000 0x00002aaaaac00000 0x0000000000000000 0x00002aab2b400000</span>
<span class="go">  1     61    0x00000000000c0000 0x000000003ff40000 0x00002aaaaacc0000 0x00000000000c0000 0x00002aababcc0000</span>

<span class="go"> Virtqueue 0 (TX)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 128 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 62 callfd 64 errfd -1</span>

<span class="go"> Virtqueue 1 (RX)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 0 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 65 callfd 66 errfd -1</span>

<span class="go"> Virtqueue 2 (TX)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 128 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 63 callfd 70 errfd -1</span>

<span class="go"> Virtqueue 3 (RX)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 0 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 72 callfd 74 errfd -1</span>

<span class="go"> Virtqueue 4 (TX disabled)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 0 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 76 callfd 78 errfd -1</span>

<span class="go"> Virtqueue 5 (RX disabled)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 0 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 80 callfd 82 errfd -1</span>

<span class="go"> Virtqueue 6 (TX disabled)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go"> avail.flags 1 avail.idx 0 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 84 callfd 86 errfd -1</span>

<span class="go"> Virtqueue 7 (RX disabled)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 0 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 88 callfd 90 errfd -1</span>
</pre></div>
</div>
<p>The optional ‘<em>descriptors</em>’ parameter will display the same output as the
previous example but will include the descriptor table for each queue. The output is truncated below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# show vhost-user VirtualEthernet0/0/0 descriptors</span>

<span class="go">Virtio vhost-user interfaces</span>
<span class="go">Global:</span>
<span class="go">  coalesce frames 32 time 1e-3</span>
<span class="go">Interface: VirtualEthernet0/0/0 (ifindex 1)</span>
<span class="go">virtio_net_hdr_sz 12</span>
<span class="go"> features mask (0xffffffffffffffff):</span>
<span class="go"> features (0x50408000):</span>
<span class="go">   VIRTIO_NET_F_MRG_RXBUF (15)</span>
<span class="go">   VIRTIO_NET_F_MQ (22)</span>
<span class="go">:</span>
<span class="go"> Virtqueue 0 (TX)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
<span class="go">  avail.flags 1 avail.idx 128 used.flags 1 used.idx 0</span>
<span class="go">  kickfd 62 callfd 64 errfd -1</span>

<span class="go">  descriptor table:</span>
<span class="go">   id          addr         len  flags  next      user_addr</span>
<span class="go">  ===== ================== ===== ====== ===== ==================</span>
<span class="go">  0     0x0000000010b6e974 2060  0x0002 1     0x00002aabbc76e974</span>
<span class="go">  1     0x0000000010b6e034 2060  0x0002 2     0x00002aabbc76e034</span>
<span class="go">  2     0x0000000010b6d6f4 2060  0x0002 3     0x00002aabbc76d6f4</span>
<span class="go">  3     0x0000000010b6cdb4 2060  0x0002 4     0x00002aabbc76cdb4</span>
<span class="go">  4     0x0000000010b6c474 2060  0x0002 5     0x00002aabbc76c474</span>
<span class="go">  5     0x0000000010b6bb34 2060  0x0002 6     0x00002aabbc76bb34</span>
<span class="go">  6     0x0000000010b6b1f4 2060  0x0002 7     0x00002aabbc76b1f4</span>
<span class="go">  7     0x0000000010b6a8b4 2060  0x0002 8     0x00002aabbc76a8b4</span>
<span class="go">  8     0x0000000010b69f74 2060  0x0002 9     0x00002aabbc769f74</span>
<span class="go">  9     0x0000000010b69634 2060  0x0002 10    0x00002aabbc769634</span>
<span class="go">  10    0x0000000010b68cf4 2060  0x0002 11    0x00002aabbc768cf4</span>
<span class="go">:</span>
<span class="go">  249   0x0000000000000000 0     0x0000 250   0x00002aab2b400000</span>
<span class="go">  250   0x0000000000000000 0     0x0000 251   0x00002aab2b400000</span>
<span class="go">  251   0x0000000000000000 0     0x0000 252   0x00002aab2b400000</span>
<span class="go">  252   0x0000000000000000 0     0x0000 253   0x00002aab2b400000</span>
<span class="go">  253   0x0000000000000000 0     0x0000 254   0x00002aab2b400000</span>
<span class="go">  254   0x0000000000000000 0     0x0000 255   0x00002aab2b400000</span>
<span class="go">  255   0x0000000000000000 0     0x0000 32768 0x00002aab2b400000</span>

<span class="go"> Virtqueue 1 (RX)</span>
<span class="go">  qsz 256 last_avail_idx 0 last_used_idx 0</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="debug-vhost-user">
<h1>Debug Vhost-User<a class="headerlink" href="#debug-vhost-user" title="Permalink to this headline">¶</a></h1>
<p>Turn on/off debug for vhost</p>
<div class="section" id="id3">
<h2>Summary/Usage<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>debug vhost-user &lt;on <span class="p">|</span> off&gt;.
</pre></div>
</div>
</div>
</div>
<div class="section" id="delete-vhost-user">
<h1>Delete Vhost-User<a class="headerlink" href="#delete-vhost-user" title="Permalink to this headline">¶</a></h1>
<p>Delete a vHost User interface using the interface name or the software
interface index. Use the ‘<em>show interface</em>’ command to determine the
software interface index. On deletion, the linux socket will not be
deleted.</p>
<div class="section" id="id4">
<h2>Summary/Usage<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>delete vhost-user <span class="o">{</span>&lt;interface&gt; <span class="p">|</span> sw_if_index &lt;sw_idx&gt;<span class="o">}</span>.
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>Examples<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Example of how to delete a vhost interface by name:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# delete vhost-user VirtualEthernet0/0/1</span>
</pre></div>
</div>
<p>Example of how to delete a vhost interface by software interface index:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vpp# delete vhost-user sw_if_index 1</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="Vhost User Commands" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, John DeNisco.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>